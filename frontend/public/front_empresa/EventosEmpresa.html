<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adopcion</title>
    <link rel="stylesheet" href="/src/styles/eventos.css">
</head>
<body>
<script>
  // Verificar si el token está presente
  const token = document.cookie.split('; ').find(row => row.startsWith('token='));

  if (!token) {
      alert("Debe iniciar sesión para ingresar a esta sección");
      window.location.href = '/login.html';
  } else {
      // Decodificar el token para obtener el rol del usuario
      const payload = JSON.parse(atob(token.split('=')[1].split('.')[1])); // Decodificar payload del JWT
      const userRole = payload.role; // Asegúrate de que el backend incluya este campo

      // Mostrar botón "Subir Publicación" solo si el rol es "empresa"
      if (userRole !== 'empresa') {
          const subirPublicacion = document.querySelector('.nav-links li a[href="subirPubli.html"]');
          if (subirPublicacion) subirPublicacion.style.display = 'none';
      }
  }
</script>
    <header class="header">
        <div class="logo">
            <a href="/index.html"><img src="/src/img/logos.png" alt=""></a>
        </div>
        <nav>
          <ul class="nav-links">
            <li><a href="index.html">Inicio</a></li>
            <li><a href="subirPubli.html">Subir Publicación</a></li>
        </ul>
         </nav>
        <div hre class="search-container">
            <input type="text" placeholder="Buscar..." id="searchBar">
            <button onclick="search()">Buscar</button>
        </div>
        
    </header>
    <main class="main">
        <div class="container text-center">
            <h3 class="miTitulo" >EMPLEOS DISPONIBLES</h3></div>
            <div class= "group-publicaciones">
              <div id="tus-publicaciones" class="card-group "></div>
          </div>
        </div>
    </main>
    <SCript>
    function crearNuevaPublicacion(username, perfil, titulo, descripcion, postId) {
    const contenedorPublicaciones = document.querySelector('.card-group');

    const nuevaTarjeta = document.createElement('div');
    nuevaTarjeta.classList.add('card-publi');

    const nuevaImagen = document.createElement('img');
    nuevaImagen.classList.add('card-img-top', 'cardImg');
    nuevaImagen.src = perfil;
    nuevaImagen.style.height = "150px";
    nuevaImagen.style.width = "150px";
    const nombreUser = document.createElement('h3');
    nombreUser.textContent = username;
    const cuerpoTarjeta = document.createElement('div');
    cuerpoTarjeta.classList.add('card-body');

    const nuevoTitulo = document.createElement('h5');
    nuevoTitulo.classList.add('card-title-publi');
    nuevoTitulo.textContent = titulo;

    const nuevaDescripcion = document.createElement('p');
    nuevaDescripcion.classList.add('card-text');
    nuevaDescripcion.textContent = descripcion;

    const enlaceLeerMas = document.createElement('a');
    enlaceLeerMas.classList.add('card-link');
    enlaceLeerMas.href = '#';
    enlaceLeerMas.textContent = 'Ver más';
    enlaceLeerMas.addEventListener('click', () => {
        if (postId) {
            console.log("Post ID:", postId); // Verifica que el valor sea correcto
            window.location.href = `/front_empresa/publicacion.html?id=${postId}`;
        } else {
            console.error('Post ID es undefined');
        }
    });

  const eliminar = document.createElement('button');
  eliminar.classList.add('card-link');
  eliminar.href = '#';
  eliminar.textContent = 'Borrar';
  eliminar.addEventListener('click', () => {
    fetch(`http://localhost:4000/post/${postId}`,{
      method: 'DELETE',
      credentials:"include"
    })
  })





  // Contenedor para las estrellas
  const contenedorEstrellas = document.createElement('div');
  // Variable para guardar la calificación seleccionada
  let calificacion = 0;
  // Función para actualizar las estrellas visualmente
  function actualizarEstrellas(puntuacion) {
    const estrellas = contenedorEstrellas.querySelectorAll('.star');
    estrellas.forEach((estrella, index) => {
      if (index < puntuacion) {
        // Cambiar el color a las estrellas seleccionadas
        estrella.firstElementChild.setAttribute('fill', 'gold');
      } else {
        // Restablecer el color de las estrellas no seleccionadas
        estrella.firstElementChild.setAttribute('fill', 'currentColor');
      }
    });
  }

  // Cerrar la modal si se hace clic fuera de la modal
  window.addEventListener('click', (event) => {
    const modal = document.getElementById('comentariosModal');
    if (event.target === modal) {
      modal.style.display = 'none'; // Oculta la modal
    }
  });

  // Añadir todo al cuerpo de la tarjeta
  cuerpoTarjeta.appendChild(nombreUser)
  cuerpoTarjeta.appendChild(nuevoTitulo);
  cuerpoTarjeta.appendChild(nuevaDescripcion);
  cuerpoTarjeta.appendChild(contenedorEstrellas); // Añadir estrellas
  cuerpoTarjeta.appendChild(enlaceLeerMas);
  cuerpoTarjeta.appendChild(eliminar);

  nuevaTarjeta.appendChild(nuevaImagen);
  nuevaTarjeta.appendChild(cuerpoTarjeta);
  contenedorPublicaciones.appendChild(nuevaTarjeta);
}    
    </Script>
    <Script>
        fetch('http://localhost:4000/post')
       .then(response => response.json()).then(
        (array)=>
        array.forEach(element => {
            crearNuevaPublicacion(element.username,element.perfil, element.title, element.description, element.id)
        })
       )
    </Script>
</body>
</html>
